# Just file: https://github.com/casey/just
debug:
    cmake -B debug \
        -DCMAKE_BUILD_TYPE=Debug \
        -DCMAKE_EXPORT_COMPILE_COMMANDS=YES \
        -DCMAKE_CUDA_COMPILER_LAUNCHER=ccache \
        -G Ninja  \
        -DCMAKE_C_FLAGS_INIT="-fsanitize=undefined -fsanitize=address" \
        -DCMAKE_CXX_FLAGS_INIT="-fsanitize=undefined -fsanitize=address" \
        -DCMAKE_CXX_FLAGS="-fdiagnostics-absolute-paths -fdiagnostics-color" \
        -DCMAKE_C_FLAGS="-fdiagnostics-absolute-paths -fdiagnostics-color" \
        -DCMAKE_CUDA_ARCHITECTURES=OFF \
        -DCMAKE_CUDA_FLAGS="-Wno-deprecated-gpu-targets -allow-unsupported-compiler -arch=native -lineinfo" \
        .
    cd debug && cmake --build . --parallel
    rm -f compile_commands.json .
    ln -s debug/compile_commands.json

run: build
    debug/pystencils_gui
    
release:
    cmake -B release \
        -DCMAKE_BUILD_TYPE=Release \
        -DCMAKE_EXPORT_COMPILE_COMMANDS=YES \
        -DCMAKE_CUDA_COMPILER_LAUNCHER=ccache \
        -G Ninja  \
        -DCMAKE_CXX_FLAGS=-fdiagnostics-color \
        -DCMAKE_C_FLAGS=-fdiagnostics-color \
        .
    cd release && cmake --build . --parallel
    rm -f compile_commands.json .
    ln -s release/compile_commands.json

install: release
    sudo cmake --install release

clean:
	rm -rf debug
	rm -rf release

clean-build: clean debug
